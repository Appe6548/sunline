<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunlineâ€”â€”æ–‡å­—å†’é™©æ¸¸æˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #1a1a1a;
        }
        .chat-container::-webkit-scrollbar {
            width: 4px;
        }
        .chat-container::-webkit-scrollbar-thumb {
            background-color: #4a4a4a;
            border-radius: 20px;
        }
        .message-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 20px;
            word-wrap: break-word;
            line-height: 1.6;
        }
        .character-message {
            background-color: #333333;
            color: #e5e5e5;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        .player-message {
            background-color: #007bff;
            color: #ffffff;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .diary-entry {
            background-color: #4a443a;
            color: #dcdcdc;
            border-left: 3px solid #f5b041;
            font-style: italic;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            align-self: flex-start;
            margin: 10px 0;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            margin: 0 2px;
            background-color: #7d7d7d;
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        .status-bar-bg {
             background-color: rgba(0, 0, 0, 0.2);
             backdrop-filter: blur(10px);
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        #modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        #audio-toggle {
            cursor: pointer;
            user-select: none;
            font-size: 16px;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        #audio-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }
        #audio-prompt {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 0.6; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto bg-gray-800 shadow-2xl rounded-2xl h-[90vh] flex flex-col">
        
        <!-- çŠ¶æ€æ  -->
        <div class="status-bar-bg p-4 border-b border-gray-700 rounded-t-2xl">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-lg font-bold text-gray-200">é€šè®¯é¢‘é“: <span class="text-green-400">æ—å³°</span></h2>
                <div class="flex items-center space-x-3">
                    <button id="audio-toggle" class="text-sm text-gray-400 hover:text-white transition-colors" title="éŸ³æ•ˆå¼€å…³">
                        ğŸ”Š
                    </button>
                    <span id="signal-strength" class="text-sm font-medium text-green-400">ä¿¡å·ç¨³å®š</span>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                    <label for="health" class="block mb-1 text-gray-400">ç”Ÿå‘½ä½“å¾</label>
                    <div class="w-full bg-gray-600 rounded-full h-2.5">
                        <div id="health-bar" class="bg-green-500 h-2.5 rounded-full progress-bar" style="width: 100%"></div>
                    </div>
                </div>
                <div>
                    <label for="radiation" class="block mb-1 text-gray-400">è¾å°„æš´éœ²</label>
                    <div class="w-full bg-gray-600 rounded-full h-2.5">
                        <div id="radiation-bar" class="bg-yellow-500 h-2.5 rounded-full progress-bar" style="width: 5%"></div>
                    </div>
                </div>
            </div>
            <div class="mt-3">
                <p class="text-xs text-gray-400">ç‰©å“æ : <span id="inventory-display" class="font-mono text-gray-300">ç©º</span></p>
            </div>
        </div>

        <!-- èŠå¤©å®¹å™¨ -->
        <div id="chat-container" class="flex-1 p-6 overflow-y-auto chat-container flex flex-col space-y-4">
            <!-- æ¶ˆæ¯ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
        </div>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div id="input-area" class="p-4 border-t border-gray-700 rounded-b-2xl">
            <div id="choices-container" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <!-- é€‰é¡¹æŒ‰é’®ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸæ¨¡æ€æ¡† -->
    <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 rounded-lg shadow-xl p-8 max-w-sm w-full text-center">
            <h2 id="modal-title" class="text-2xl font-bold mb-4">æ¸¸æˆç»“æŸ</h2>
            <p id="modal-message" class="text-gray-300 mb-6">ä½ æœªèƒ½æˆåŠŸå¼•å¯¼ä»–æ´»ä¸‹æ¥ã€‚</p>
            <button onclick="restartGame()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300">é‡æ–°å¼€å§‹</button>
        </div>
    </div>

    <!-- éŸ³æ•ˆå¯ç”¨æç¤º -->
    <div id="audio-prompt" class="fixed bottom-4 right-4 bg-gray-800 text-white p-3 rounded-lg shadow-lg text-sm opacity-90 transition-opacity duration-300">
        <div class="flex items-center space-x-2">
            <span>ğŸ”Š</span>
            <span>ç‚¹å‡»ä»»æ„åœ°æ–¹å¯ç”¨éŸ³æ•ˆ</span>
        </div>
    </div>


    <script>
        const chatContainer = document.getElementById('chat-container');
        const choicesContainer = document.getElementById('choices-container');
        const healthBar = document.getElementById('health-bar');
        const radiationBar = document.getElementById('radiation-bar');
        const inventoryDisplay = document.getElementById('inventory-display');
        const modalOverlay = document.getElementById('modal-overlay');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');

        let gameState = {};

        // ä½¿ç”¨ Tone.js çš„éŸ³æ•ˆç³»ç»Ÿ
        const soundState = {
            isInitialized: false,
            isEnabled: true,
            synths: {},
            loops: {},

            // åˆå§‹åŒ–éŸ³æ•ˆç³»ç»Ÿ
            async init() {
                if (this.isInitialized) return;

                try {
                    // æ˜¾ç¤ºåŠ è½½æç¤º
                    const audioPrompt = document.getElementById('audio-prompt');
                    if (audioPrompt) {
                        audioPrompt.innerHTML = '<div class="flex items-center space-x-2"><span>ğŸ”Š</span><span>æ­£åœ¨åˆå§‹åŒ–éŸ³æ•ˆç³»ç»Ÿ...</span></div>';
                    }

                    // å¯åŠ¨ Tone.js éŸ³é¢‘ä¸Šä¸‹æ–‡
                    await Tone.start();

                    // åˆ›å»ºå„ç§åˆæˆå™¨ï¼ˆ"ä¹å™¨"ï¼‰
                    this.createSynths();

                    // åˆ›å»ºèƒŒæ™¯æ°›å›´éŸ³
                    this.createAmbience();

                    this.isInitialized = true;
                    console.log('Tone.js éŸ³æ•ˆç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ');

                    // æ›´æ–°æç¤º
                    if (audioPrompt) {
                        audioPrompt.innerHTML = '<div class="flex items-center space-x-2"><span>âœ…</span><span>éŸ³æ•ˆç³»ç»Ÿå·²å¯ç”¨</span></div>';
                        setTimeout(() => {
                            audioPrompt.style.opacity = '0';
                            setTimeout(() => audioPrompt.style.display = 'none', 300);
                        }, 1500);
                    }
                } catch (error) {
                    console.warn('éŸ³æ•ˆç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', error);
                    const audioPrompt = document.getElementById('audio-prompt');
                    if (audioPrompt) {
                        audioPrompt.innerHTML = '<div class="flex items-center space-x-2"><span>âŒ</span><span>éŸ³æ•ˆç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥</span></div>';
                        setTimeout(() => {
                            audioPrompt.style.opacity = '0';
                            setTimeout(() => audioPrompt.style.display = 'none', 300);
                        }, 2000);
                    }
                }
            },

            // åˆ›å»ºå„ç§åˆæˆå™¨
            createSynths() {
                // æ¶ˆæ¯æç¤ºéŸ³ - æŸ”å’Œçš„æ­£å¼¦æ³¢
                this.synths.message = new Tone.Synth({
                    oscillator: { type: "sine" },
                    envelope: { attack: 0.1, decay: 0.3, sustain: 0.1, release: 0.5 }
                }).toDestination();

                // é€‰é¡¹ç‚¹å‡»éŸ³ - æ¸…è„†çš„æ–¹æ³¢
                this.synths.select = new Tone.Synth({
                    oscillator: { type: "square" },
                    envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 }
                }).toDestination();

                // å‘ç°ç‰©å“éŸ³ - æ˜äº®çš„ä¸‰è§’æ³¢
                this.synths.discover = new Tone.Synth({
                    oscillator: { type: "triangle" },
                    envelope: { attack: 0.05, decay: 0.2, sustain: 0.3, release: 0.8 }
                }).toDestination();

                // è­¦å‘ŠéŸ³ - åˆºè€³çš„é”¯é½¿æ³¢
                this.synths.warning = new Tone.Synth({
                    oscillator: { type: "sawtooth" },
                    envelope: { attack: 0.01, decay: 0.1, sustain: 0.8, release: 0.3 }
                }).toDestination();

                // ç»“å±€éŸ³æ•ˆ - å’Œå¼¦åˆæˆå™¨
                this.synths.ending = new Tone.PolySynth().toDestination();

                // ææ€–éŸ³æ•ˆ - ä½é¢‘å™ªéŸ³åˆæˆå™¨
                this.synths.horror = new Tone.NoiseSynth({
                    noise: { type: "brown" },
                    envelope: { attack: 0.1, decay: 1, sustain: 0.1, release: 2 }
                }).toDestination();

                // å¿ƒè·³éŸ³æ•ˆ - ä½é¢‘è„‰å†²
                this.synths.heartbeat = new Tone.MembraneSynth({
                    pitchDecay: 0.05,
                    octaves: 2,
                    oscillator: { type: "sine" },
                    envelope: { attack: 0.001, decay: 0.4, sustain: 0.01, release: 1.4 }
                }).toDestination();
            },

            // åˆ›å»ºèƒŒæ™¯æ°›å›´éŸ³
            createAmbience() {
                // åˆ›å»ºä½é¢‘æ°›å›´éŸ³å¾ªç¯
                const ambienceFilter = new Tone.Filter(200, "lowpass").toDestination();
                const ambienceOsc = new Tone.Oscillator(55, "sine").connect(ambienceFilter);
                const ambienceGain = new Tone.Gain(0.1).connect(ambienceFilter);
                ambienceOsc.connect(ambienceGain);

                // åˆ›å»ºéšæœºè§¦å‘çš„æ°›å›´éŸ³æ•ˆ
                this.loops.ambience = new Tone.Loop((time) => {
                    if (this.isEnabled && Math.random() < 0.3) {
                        // éšæœºæ’­æ”¾ä½æ²‰çš„æ°›å›´éŸ³
                        const freq = 40 + Math.random() * 60;
                        ambienceOsc.frequency.setValueAtTime(freq, time);
                        ambienceGain.gain.setValueAtTime(0, time);
                        ambienceGain.gain.linearRampToValueAtTime(0.05, time + 0.5);
                        ambienceGain.gain.linearRampToValueAtTime(0, time + 3);
                    }
                }, "8m"); // æ¯8åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡

                ambienceOsc.start();
                this.loops.ambience.start();
            }
        };

        // æ’­æ”¾éŸ³æ•ˆçš„æ ¸å¿ƒå‡½æ•°
        function playSound(soundType, note = "C4", duration = "8n", volume = 0.5) {
            if (!soundState.isInitialized || !soundState.isEnabled) return;

            try {
                const synth = soundState.synths[soundType];
                if (!synth) return;

                // è®¾ç½®éŸ³é‡
                synth.volume.value = Tone.gainToDb(volume);

                switch (soundType) {
                    case 'message':
                        // æ¶ˆæ¯æç¤ºéŸ³ - æŸ”å’Œçš„ä¸Šå‡éŸ³è°ƒ
                        synth.triggerAttackRelease("G4", "8n");
                        setTimeout(() => synth.triggerAttackRelease("C5", "8n"), 100);
                        break;

                    case 'select':
                        // é€‰é¡¹ç‚¹å‡»éŸ³ - æ¸…è„†çš„å•éŸ³
                        synth.triggerAttackRelease("E5", "16n");
                        break;

                    case 'discover':
                        // å‘ç°ç‰©å“éŸ³ - æ„‰æ‚¦çš„ä¸‰éŸ³ç¬¦
                        synth.triggerAttackRelease("C5", "8n");
                        setTimeout(() => synth.triggerAttackRelease("E5", "8n"), 150);
                        setTimeout(() => synth.triggerAttackRelease("G5", "4n"), 300);
                        break;

                    case 'warning':
                        // è­¦å‘ŠéŸ³ - åˆºè€³çš„é‡å¤éŸ³
                        for (let i = 0; i < 3; i++) {
                            setTimeout(() => synth.triggerAttackRelease("A3", "16n"), i * 200);
                        }
                        break;

                    case 'horror':
                        // ææ€–éŸ³æ•ˆ - å™ªéŸ³çˆ†å‘
                        synth.triggerAttackRelease("2n");
                        break;

                    case 'heartbeat':
                        // å¿ƒè·³éŸ³æ•ˆ - ä½é¢‘è„‰å†²
                        synth.triggerAttackRelease("C1", "8n");
                        setTimeout(() => synth.triggerAttackRelease("C1", "16n"), 200);
                        break;

                    default:
                        synth.triggerAttackRelease(note, duration);
                }
            } catch (error) {
                console.warn('æ’­æ”¾éŸ³æ•ˆå¤±è´¥:', error);
            }
        }

        // æ’­æ”¾ç»“å±€éŸ³æ•ˆ
        function playEndingSound(isGoodEnding = true) {
            if (!soundState.isInitialized || !soundState.isEnabled) return;

            try {
                const synth = soundState.synths.ending;
                synth.volume.value = Tone.gainToDb(0.3);

                if (isGoodEnding) {
                    // å¥½ç»“å±€ - å¤§è°ƒå’Œå¼¦è¿›è¡Œ
                    const chords = [
                        ["C4", "E4", "G4"],
                        ["F4", "A4", "C5"],
                        ["G4", "B4", "D5"],
                        ["C5", "E5", "G5"]
                    ];

                    chords.forEach((chord, index) => {
                        setTimeout(() => {
                            synth.triggerAttackRelease(chord, "2n");
                        }, index * 800);
                    });
                } else {
                    // åç»“å±€ - å°è°ƒå’Œå¼¦ï¼Œä¸å’Œè°éŸ³
                    const chords = [
                        ["C4", "Eb4", "G4"],
                        ["F4", "Ab4", "C5"],
                        ["G4", "Bb4", "D5"],
                        ["C4", "Eb4", "Gb4"]
                    ];

                    chords.forEach((chord, index) => {
                        setTimeout(() => {
                            synth.triggerAttackRelease(chord, "2n");
                        }, index * 1000);
                    });
                }
            } catch (error) {
                console.warn('æ’­æ”¾ç»“å±€éŸ³æ•ˆå¤±è´¥:', error);
            }
        }

        // å¼€å§‹/åœæ­¢å¿ƒè·³å¾ªç¯
        function startHeartbeatLoop() {
            if (soundState.heartbeatLoop) return;

            soundState.heartbeatLoop = new Tone.Loop((time) => {
                if (soundState.isEnabled && gameState.health <= 30) {
                    playSound('heartbeat', "C1", "8n", 0.4);
                }
            }, "1.2s");

            soundState.heartbeatLoop.start();
        }

        function stopHeartbeatLoop() {
            if (soundState.heartbeatLoop) {
                soundState.heartbeatLoop.stop();
                soundState.heartbeatLoop.dispose();
                soundState.heartbeatLoop = null;
            }
        }

        // éŸ³æ•ˆæ§åˆ¶
        const audioToggle = document.getElementById('audio-toggle');

        audioToggle.addEventListener('click', () => {
            soundState.isEnabled = !soundState.isEnabled;
            audioToggle.textContent = soundState.isEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            audioToggle.title = soundState.isEnabled ? 'å…³é—­éŸ³æ•ˆ' : 'å¼€å¯éŸ³æ•ˆ';

            if (!soundState.isEnabled) {
                // åœæ­¢å¿ƒè·³å¾ªç¯
                stopHeartbeatLoop();

                // åœæ­¢æ°›å›´éŸ³å¾ªç¯
                if (soundState.loops.ambience) {
                    soundState.loops.ambience.stop();
                }
            } else {
                // æ’­æ”¾æµ‹è¯•éŸ³æ•ˆ
                playSound('select');

                // é‡æ–°å¼€å§‹æ°›å›´éŸ³
                if (soundState.loops.ambience) {
                    soundState.loops.ambience.start();
                }

                // å¦‚æœç”Ÿå‘½å€¼ä½ï¼Œé‡æ–°å¼€å§‹å¿ƒè·³
                if (gameState.health <= 30) {
                    startHeartbeatLoop();
                }
            }
        });

        function restartGame() {
            gameState = {
                health: 100,
                radiation: 5,
                inventory: [],
                currentScene: 'start',
                flags: {},
            };
            chatContainer.innerHTML = '';
            modalOverlay.classList.add('hidden');

            // åœæ­¢å¿ƒè·³å¾ªç¯
            stopHeartbeatLoop();

            updateStatus();
            playScene('start');
        }


        const story = {
            'start': {
                text: [
                    "...å–‚...æœ‰äººå—ï¼Ÿ",
                    "æˆ‘çš„é€šè®¯è®¾å¤‡å¥½åƒä¿®å¥½äº†...é‡å¤ï¼Œè¿™é‡Œæ˜¯å‹˜æ¢é˜Ÿé˜Ÿå‘˜æ—å³°ï¼Œæœ‰äººèƒ½æ”¶åˆ°å—ï¼Ÿ",
                    "æˆ‘è·Ÿé˜Ÿä¼å¤±æ•£äº†ï¼Œè¢«å›°åœ¨...ä¸€ä¸ªé¬¼åœ°æ–¹ã€‚è¿™é‡Œçœ‹èµ·æ¥åƒä¸ªåºŸå¼ƒçš„å­¦æ ¡ã€‚"
                ],
                choices: [
                    { text: "æˆ‘æ˜¯æ•‘æ´åè°ƒå‘˜ã€‚æˆ‘èƒ½æ”¶åˆ°ï¼Œæ—å³°ã€‚æŠ¥å‘Šä½ çš„æƒ…å†µã€‚", nextScene: 'reportStatus' },
                    { text: "ä½ æ˜¯è°ï¼Ÿä½ æ€ä¹ˆè¿æ¥åˆ°è¿™ä¸ªå®‰å…¨é¢‘é“çš„ï¼Ÿ", nextScene: 'whoAreYou' }
                ]
            },
            'whoAreYou': {
                text: [
                    "æˆ‘...æˆ‘æ˜¯å‹˜æ¢é˜Ÿçš„æ—å³°ï¼æˆ‘çš„é˜Ÿå‘˜ç¼–å·æ˜¯734ï¼è®¾å¤‡æ˜¯åœ¨é£æš´ä¸­æŸåçš„ï¼Œæˆ‘åˆšä¿®å¥½å®ƒï¼Œå®ƒå°±è‡ªåŠ¨è¿æ¥åˆ°äº†è¿™ä¸ªé¢‘é“ï¼",
                    "æˆ‘éœ€è¦å¸®åŠ©ï¼è¯·ç¡®è®¤ä½ çš„èº«ä»½ï¼"
                ],
                choices: [
                    { text: "å¥½äº†ï¼Œæ—å³°ï¼Œåˆ«æ¿€åŠ¨ã€‚æˆ‘æ˜¯åè°ƒå‘˜ã€‚æŠ¥å‘Šä½ çš„æƒ…å†µã€‚", nextScene: 'reportStatus' },
                    { text: "å†·é™ã€‚æˆ‘æ­£åœ¨æ ¸å®ä½ çš„èº«ä»½ã€‚å¾…åœ¨åŸåœ°åˆ«åŠ¨ã€‚", nextScene: 'verifyingIdentity' }
                ]
            },
            'verifyingIdentity': {
                text: [
                    "ï¼ˆå‡ ç§’é’Ÿçš„æ²‰é»˜ï¼‰",
                    "æ ¸å®...ï¼Ÿå¥½å§ï¼Œæˆ‘ç­‰ã€‚ä½†è¿™é‡Œè®©æˆ‘æ„Ÿè§‰å¾ˆä¸èˆ’æœã€‚"
                ],
                choices: [
                    { text: "èº«ä»½æ ¸å®å®Œæ¯•ã€‚æ—å³°ï¼ŒæŠ¥å‘Šä½ çš„æƒ…å†µã€‚", nextScene: 'reportStatus' },
                    { text: "ä½ çš„èº«ä»½æœ‰ç–‘ç‚¹ï¼Œä½†ç°åœ¨æ²¡æ—¶é—´äº†ã€‚æŠ¥å‘Šæƒ…å†µã€‚", nextScene: 'reportStatus' }
                ]
            },
            'reportStatus': {
                text: [
                    "åè°ƒå‘˜ï¼Ÿï¼å¤ªå¥½äº†ï¼æˆ‘è¿˜ä»¥ä¸º...",
                    "æ€»ä¹‹ï¼Œæˆ‘æœ€åä¸€æ¬¡è§åˆ°é˜Ÿé•¿æ˜¯åœ¨å­¦æ ¡ä¸»æ¥¼çš„å…¥å£ã€‚æˆ‘ä»¬å½“æ—¶æ­£åœ¨èº²é¿ä¸€åœºçªå¦‚å…¶æ¥çš„è¾å°„é£æš´ï¼Œç„¶å...æˆ‘å°±è·Ÿä¸¢äº†ã€‚",
                    "æˆ‘ç°åœ¨çš„ä½ç½®...å¥½åƒæ˜¯ä¸€ä¸ªå¤§å…ã€‚åˆ°å¤„éƒ½æ˜¯ç°ï¼Œç©ºæ°”é‡Œæœ‰è‚¡é“é”ˆå’Œ...è…çƒ‚çš„å‘³é“ã€‚æˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ",
                ],
                choices: [
                    { text: "ä¿æŒå†·é™ã€‚å…ˆæ‰¾ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ã€‚æ£€æŸ¥å‘¨å›´ç¯å¢ƒã€‚", nextScene: 'exploreHall' },
                    { text: "åˆ«ä¹±åŠ¨ï¼Œå¾…åœ¨åŸåœ°ã€‚ä½ çš„ç”Ÿå‘½ä½“å¾å¦‚ä½•ï¼Ÿ", nextScene: 'checkVitals' }
                ]
            },
            'checkVitals': {
                text: [
                    "æˆ‘...æˆ‘æ„Ÿè§‰å¤´æœ‰ç‚¹æ™•ï¼Œå¯èƒ½æ˜¯åˆšæ‰æ‘”äº†ä¸€ä¸‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåº”è¯¥è¿˜å¥½ã€‚",
                    "è®¾å¤‡æ˜¾ç¤ºæˆ‘çš„ç”Ÿå‘½ä½“å¾ç¨³å®šï¼Œä½†è¾å°„æ¢æµ‹å™¨ä¸€ç›´åœ¨å“ï¼Œè™½ç„¶è¯»æ•°è¿˜ä¸ç®—å¤ªé«˜ã€‚",
                    "æˆ‘çœŸçš„è¦ä¸€ç›´å¾…åœ¨è¿™é‡Œå—ï¼Ÿæ„Ÿè§‰å¾ˆä¸å®‰ã€‚"
                ],
                choices: [
                     { text: "å¥½å§ï¼Œé‚£ä½ å»æ¢ç´¢ä¸€ä¸‹å¤§å…ï¼Œä½†è¦ä¸‡åˆ†å°å¿ƒã€‚", nextScene: 'exploreHall' },
                     { text: "åŸåœ°ä¼‘æ¯ä¸€ä¸‹ã€‚é—­ä¸Šçœ¼ç›ï¼Œåšå‡ æ¬¡æ·±å‘¼å¸ã€‚", nextScene: 'restInHall' }
                ]
            },
            'restInHall': {
                text: [
                    "å¥½çš„...å‘¼...å¸...",
                    "æ„Ÿè§‰å¥½ä¸€ç‚¹äº†ï¼Œå¤´ä¸é‚£ä¹ˆæ™•äº†ã€‚è°¢è°¢ä½ ï¼Œåè°ƒå‘˜ã€‚",
                    "æˆ‘å‡†å¤‡å¥½è¡ŒåŠ¨äº†ã€‚"
                ],
                action: () => {
                    gameState.health = Math.min(100, gameState.health + 5);
                    updateStatus();
                },
                choices: [
                    { text: "å¾ˆå¥½ï¼Œç°åœ¨å»æ¢ç´¢å¤§å…ã€‚", nextScene: 'exploreHall' },
                    { text: "æ„Ÿè§‰å¥½ç‚¹å°±è¡Œï¼Œæˆ‘ä»¬å¾—èµ°äº†ã€‚", nextScene: 'exploreHall' }
                ]
            },
            'exploreHall': {
                text: [
                    "æ”¶åˆ°ã€‚æ­£åœ¨è§‚å¯Ÿ...",
                    "å¤§å…å¾ˆç©ºæ—·ï¼Œåœ°ä¸Šæ•£è½ç€ä¸€äº›ç ´æŸçš„æ¡Œæ¤…ã€‚å·¦æ‰‹è¾¹æœ‰æ‰‡é—¨ï¼Œæ ‡ç‰Œä¸Šå†™ç€'å­¦æ ¡å•†åº—'ã€‚å³æ‰‹è¾¹æ˜¯'é£Ÿå ‚'ã€‚æ­£å‰æ–¹æ˜¯ä¸€æ¡èµ°å»Šï¼Œé€šå‘æ›´æ·±å¤„ã€‚",
                    "æˆ‘åº”è¯¥å…ˆå»å“ªé‡Œï¼Ÿ"
                ],
                choices: [
                    { text: "å»å­¦æ ¡å•†åº—çœ‹çœ‹ã€‚å¯èƒ½ä¼šæœ‰èƒ½ç”¨çš„ç‰©èµ„ã€‚", nextScene: 'enterStore' },
                    { text: "å»é£Ÿå ‚çœ‹çœ‹ã€‚å°å¿ƒç‚¹ï¼Œé‡Œé¢å¯èƒ½ä¸å¹²å‡€ã€‚", nextScene: 'enterCafeteria' },
                ]
            },
            'enterCafeteria': {
                text: [
                    "æ­£åœ¨è¿›å…¥é£Ÿå ‚...è¿™é‡Œçš„å‘³é“...æ¯”å¤§å…éš¾é—»å¤šäº†ã€‚",
                    "é¤ç›˜éƒ½è¿˜æ‘†åœ¨æ¡Œä¸Šï¼Œä¸Šé¢çš„ä¸œè¥¿å·²ç»å˜æˆäº†æ— æ³•å½¢å®¹çš„é»‘è‰²ç‰©è´¨ã€‚åœ°ä¸Šé»ç³Šç³Šçš„ã€‚",
                    "æˆ‘æ£€æŸ¥äº†ä¸€ä¸‹å¨æˆ¿ï¼Œæ²¡ä»€ä¹ˆèƒ½ç”¨çš„ä¸œè¥¿ï¼Œåè€Œæ„Ÿè§‰æœ‰ç‚¹æ¶å¿ƒã€‚",
                    "è¿™é‡Œçš„è¾å°„å€¼æ¯”å¤§å…é«˜ä¸€ç‚¹ã€‚"
                ],
                action: () => {
                    gameState.health -= 5;
                    gameState.radiation += 5;
                    updateStatus();
                },
                choices: [
                    { text: "å¿«å‡ºæ¥ï¼Œé‚£é‡Œä¸å®‰å…¨ã€‚å›å¤§å…ã€‚", nextScene: 'exploreHall_afterCafeteria' },
                    { text: "å†ä»”ç»†æ‰¾æ‰¾å¨æˆ¿ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ç½å¤´ä¹‹ç±»çš„ã€‚", nextScene: 'searchKitchen' }
                ]
            },
            'searchKitchen': {
                text: [
                    "å¥½å§ï¼Œæˆ‘å†çœ‹çœ‹...ä¸ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚åªæœ‰è…çƒ‚çš„ä¸œè¥¿å’Œç”Ÿé”ˆçš„å¨å…·ã€‚",
                    "ç­‰ä¸€ä¸‹...æˆ‘åœ¨ä¸€ä¸ªæŸœå­æ·±å¤„æ‰¾åˆ°ä¸€åŒ…å¯†å°çš„ç›ã€‚ä¹Ÿè®¸æœ‰ç”¨ï¼Ÿ"
                ],
                choices: [
                    { text: "æ²¡å‡†ç”¨å¾—ä¸Šã€‚æ‹¿ä¸Šå®ƒï¼Œç¦»å¼€é£Ÿå ‚ã€‚", nextScene: 'takeSalt' },
                    { text: "ç›æ²¡ä»€ä¹ˆç”¨ï¼Œåˆ«ç®¡äº†ã€‚å¿«ç¦»å¼€é‚£é‡Œã€‚", nextScene: 'exploreHall_afterCafeteria' }
                ]
            },
            'takeSalt': {
                text: ["å¥½å§ï¼Œæ‹¿ä¸Šäº†ã€‚æˆ‘ä»¬èµ°ã€‚"],
                action: () => {
                    gameState.inventory.push('ç›');
                    updateStatus();
                },
                choices: [
                     { text: "ç¦»å¼€é£Ÿå ‚ï¼Œå›å¤§å…ã€‚", nextScene: 'exploreHall_afterCafeteria' }
                ]
            },
            'exploreHall_afterCafeteria': {
                text: ["å‡ºæ¥äº†ã€‚çœ‹æ¥é£Ÿå ‚æ˜¯ä¸ªé”™è¯¯çš„é€‰æ‹©ã€‚"],
                choices: [
                    { text: "é‚£ç°åœ¨å»å­¦æ ¡å•†åº—çœ‹çœ‹ã€‚", nextScene: 'enterStore' },
                    { text: "ç›´æ¥å»èµ°å»Šçœ‹çœ‹å‘¢ã€‚", nextScene: 'mainCorridor' }
                ]
            },
             'enterStore': {
                text: [
                    "å¥½çš„ï¼Œæ­£åœ¨è¿›å…¥å•†åº—ã€‚",
                    "è¿™é‡Œ...è´§æ¶éƒ½å€’äº†ï¼Œä¸œè¥¿æ•£äº†ä¸€åœ°ã€‚",
                    "æˆ‘åœ¨æŸœå°åé¢å‘ç°äº†ä¸€æœ¬æ»¡æ˜¯æ²¹æ±¡çš„é‡‡è´­è´¦æœ¬ã€‚ä¸Šé¢æ½¦è‰åœ°è®°å½•ç€...å¤©å“ªï¼Œå…¨æ˜¯äº›å«'æ™¯å¾·é•‡åœŸç‰¹äº§'çš„ä¸œè¥¿ï¼Œä¾›åº”å•†æ˜¯... 'æ˜Œæ™¯é»„'ã€‚å¤‡æ³¨é‡Œå†™ç€'æˆæœ¬æä½ï¼Œåˆ©æ¶¦å¯è§‚'ã€‚",
                    "é™¤äº†è´¦æœ¬ï¼Œæˆ‘è¿˜æ‰¾åˆ°ä¸€ç“¶å¯†å°å®Œå¥½çš„æ°´ã€‚"
                ],
                action: () => {
                    gameState.inventory.push('ç“¶è£…æ°´');
                },
                choices: [
                    { text: "æ˜Œæ™¯é»„...è®°ä½è¿™ä¸ªåå­—ã€‚æ‹¿ä¸Šæ°´å’Œè´¦æœ¬ï¼Œæˆ‘ä»¬ç¦»å¼€ã€‚", nextScene: 'takeLedger' },
                    { text: "è¿™è´¦æœ¬å¤ªå¯ç–‘äº†ã€‚å°å¿ƒæœ‰å±é™©ï¼ŒæŠŠå®ƒè—å¥½ï¼Œåªæ‹¿èµ°æ°´ã€‚", nextScene: 'store_exit' }
                ]
            },
            'takeLedger': {
                text: ["æ˜ç™½äº†ã€‚è´¦æœ¬å’Œæ°´éƒ½æ‹¿ä¸Šäº†ã€‚æ€»è§‰å¾—è¿™ä¸ªåå­—èƒŒåæœ‰é¬¼ã€‚"],
                 action: () => {
                    gameState.flags.knowsChangJingHuang = true;
                    gameState.inventory.push('é‡‡è´­è´¦æœ¬');
                    updateStatus();
                },
                choices: [
                    { text: "å¾ˆå¥½ï¼Œç°åœ¨å»èµ°å»Šã€‚", nextScene: 'mainCorridor' }
                ]
            },
            'store_exit': {
                text: [ "æ°´æ‹¿ä¸Šäº†ã€‚æˆ‘ä»¬èµ°å§ã€‚" ],
                choices: [
                    { text: "å»èµ°å»Šã€‚", nextScene: 'mainCorridor' }
                ]
            },
            'mainCorridor': {
                text: [
                    "æˆ‘å›åˆ°å¤§å…ï¼Œç°åœ¨æ­£æ²¿ç€èµ°å»Šèµ°ã€‚",
                    "èµ°å»Šä¸¤è¾¹æœ‰å‡ ä¸ªæˆ¿é—´ã€‚å·¦è¾¹æ˜¯'æ•™å®¤'ï¼Œå³è¾¹æ˜¯'æ´—æ‰‹é—´'ã€‚èµ°å»Šå°½å¤´å¥½åƒæ˜¯'æ“åœº'çš„å‡ºå£ï¼Œæˆ‘èƒ½é—»åˆ°ä¸€è‚¡...éå¸¸éš¾é—»çš„å‘³é“ä»é‚£è¾¹é£˜è¿‡æ¥ã€‚",
                    "æˆ‘çš„è¾å°„æ¢æµ‹å™¨è¯»æ•°åœ¨ä¸Šå‡ã€‚"
                ],
                action: () => {
                    gameState.radiation += 10;
                    updateStatus();
                },
                choices: [
                    { text: "è¿›æ•™å®¤çœ‹çœ‹ã€‚ä¹Ÿè®¸æœ‰åœ°å›¾æˆ–è€…è¯å“ã€‚", nextScene: 'enterClassroom' },
                    { text: "æ´—æ‰‹é—´å°±å…äº†ã€‚å»æ“åœºçœ‹çœ‹å‘³é“çš„æ¥æºã€‚", nextScene: 'goToPlayground' },
                ]
            },
            'enterClassroom': {
                text: [
                    "æ•™å®¤é‡Œä¸€å›¢ç³Ÿï¼Œæ¡Œæ¤…ä¸œå€’è¥¿æ­ªã€‚",
                    "æˆ‘åœ¨ä¸€ä¸ªå€’ä¸‹çš„ä¹¦æ¶é‡Œç¿»æ‰¾...æ‰¾åˆ°ä¸€ä¸ªæ€¥æ•‘ç›’ï¼",
                    "ç­‰ç­‰...æ€¥æ•‘ç›’ä¸‹é¢ï¼Œè¿˜æœ‰ä¸€æœ¬å°å°çš„æ—¥è®°æœ¬ï¼Œå°é¢ç”»ç€ä¸€åªæ­ªæ­ªæ‰­æ‰­çš„æ¯›æ¯›è™«ã€‚"
                ],
                action: () => {
                    gameState.inventory.push('æ­¢ç—›è¯');
                    gameState.inventory.push('ç»·å¸¦');
                    updateStatus();
                },
                choices: [
                    { text: "å…ˆæ”¶å¥½æ€¥æ•‘ç›’ã€‚ç„¶åï¼Œçœ‹çœ‹æ—¥è®°é‡Œå†™äº†ä»€ä¹ˆã€‚", nextScene: 'readDiary' },
                    { text: "æ—¥è®°ä¸é‡è¦ï¼ŒæŠŠæ€¥æ•‘ç›’é‡Œçš„ä¸œè¥¿æ‹¿ä¸Šå°±èµ°ã€‚", nextScene: 'classroom_afterSearch' }
                ]
            },
            'readDiary': {
                text: [
                    "å¥½çš„...æˆ‘ç¿»å¼€æ—¥è®°...å­—è¿¹å¾ˆæ½¦è‰...",
                    "'ä»Šå¤©åˆæ˜¯æ‰“é’ˆå’Œåƒâ€˜èªæ˜è±†â€™çš„æ—¥å­ã€‚è€å¸ˆè¯´è¿™æ˜¯ä¸ºäº†è®©æˆ‘ä»¬æ›´å¥åº·ï¼Œä½†æˆ‘çš„å¤´å¥½ç—›ã€‚å¤§é¸¡æ’æœ€è¿‘æ€»æ˜¯å¾ˆç”Ÿæ°”ï¼Œä»–æŠŠç©å…·éƒ½å¼„åäº†ï¼Œè¿˜æŠ“ä¼¤äº†æ»šæ»šè›‹ã€‚è€å¸ˆæŠŠä»–å¸¦èµ°äº†ï¼Œè¯´è¦å»â€˜ç‰¹åˆ«å…³ç…§å®¤â€™ã€‚æˆ‘æœ‰ç‚¹æ€•ã€‚'"
                ],
                specialClass: 'diary-entry',
                 action: () => {
                    gameState.flags.foundDiary = true;
                },
                choices: [
                    { text: "è¿™...è¿™æ ¹æœ¬ä¸æ˜¯å­¦æ ¡ã€‚æ”¶å¥½æ—¥è®°ï¼Œæˆ‘ä»¬å¿…é¡»ææ¸…æ¥šçœŸç›¸ã€‚", nextScene: 'takeDiary' },
                    { text: "å¤ªä»¤äººä¸å®‰äº†ã€‚æŠŠæ—¥è®°æ”¾å›å»ï¼Œå°å¿ƒæœ‰è¾å°„ï¼Œæˆ‘ä»¬ç¦»å¼€è¿™é‡Œã€‚", nextScene: 'classroom_afterSearch' }
                ]
            },
            'takeDiary': {
                text: ["æ—¥è®°æ”¶å¥½äº†ã€‚"],
                 action: () => {
                    gameState.inventory.push('å­©å­çš„æ—¥è®°');
                    updateStatus();
                },
                choices: [
                    { text: "æˆ‘ä»¬èµ°ã€‚", nextScene: 'classroom_afterSearch' }
                ]
            },
            'classroom_afterSearch': {
                text: [
                    "æˆ‘çš„å¿ƒè·³å¾—å¾ˆå¿«...è¿™é‡Œå¤ªä¸å¯¹åŠ²äº†ã€‚",
                    "ç°åœ¨æˆ‘æ„Ÿè§‰æˆ‘ä»¬é¢å¯¹çš„ä¸æ˜¯ç®€å•çš„æ ¸äº‹æ•…ã€‚æ¥ä¸‹æ¥å»å“ªé‡Œï¼Ÿ"
                ],
                choices: [
                    { text: "å»æ“åœºé‚£è¾¹çœ‹çœ‹ï¼Œä½†åŠ¡å¿…å°å¿ƒé‚£è‚¡å‘³é“ã€‚", nextScene: 'goToPlayground' },
                    { text: "å»èµ°å»Šå¦ä¸€å¤´çœ‹çœ‹ï¼Œè¿œç¦»æ“åœºçš„è‡­å‘³ã€‚", nextScene: 'exploreFirstFloor' }
                ]
            },
            'goToPlayground': {
                text: [
                    "å¤©å“ª...æˆ‘ä¸€æ‰“å¼€é€šå¾€æ“åœºçš„é—¨ï¼Œé‚£è‚¡å‘³é“å°±æ‰‘é¢è€Œæ¥...å¤ªæ¶å¿ƒäº†ï¼Œæˆ‘å·®ç‚¹åå‡ºæ¥ã€‚",
                    "æ“åœºä¸Š...é•¿æ»¡äº†å¥‡æ€ªçš„ã€å‘ç€å¾®å…‰çš„æ¤ç‰©ã€‚è¾å°„æ¢æµ‹å™¨çš„è­¦æŠ¥å£°å˜å¾—éå¸¸å°–é”ã€‚",
                    "æˆ‘æ„Ÿè§‰çš®è‚¤åˆºç—›ï¼Œå¤´ä¹Ÿå¼€å§‹ç–¼äº†ã€‚"
                ],
                action: () => {
                    gameState.health -= 15;
                    gameState.radiation += 25;
                    updateStatus();
                },
                choices: [
                    { text: "å¿«ç¦»å¼€é‚£é‡Œï¼è¾å°„å¤ªå¼ºäº†ï¼", nextScene: 'playground_retreat' },
                    { text: "åšæŒä½ï¼çœ‹çœ‹æœ‰æ²¡æœ‰é˜Ÿå‘˜ç•™ä¸‹çš„è¸ªè¿¹ï¼æ²¡å‡†æœ‰é€ƒç”Ÿçš„å¸Œæœ›ï¼", nextScene: 'playground_search' }
                ]
            },
            'playground_retreat': {
                text: [
                    "æ”¶åˆ°ï¼æˆ‘æ­£åœ¨åé€€...å·²ç»å›åˆ°èµ°å»Šäº†ã€‚",
                    "å’³å’³...æ„Ÿè§‰å¥½å¤šäº†ã€‚é‚£åœ°æ–¹å¤ªå¯æ€•äº†ã€‚"
                ],
                choices: [
                    { text: "ä½ åšå¾—å¯¹ã€‚æˆ‘ä»¬ä¸èƒ½å†’é™©ã€‚æ¢ç´¢ä¸€ä¸‹ä¸€æ¥¼çš„å…¶ä»–åœ°æ–¹ã€‚", nextScene: 'exploreFirstFloor' },
                    { text: "å…ˆå›æ•™å®¤ä¼‘æ¯ä¸€ä¸‹ï¼Œæ¢å¤çŠ¶æ€ã€‚", nextScene: 'restInClassroom' }
                ]
            },
            'restInClassroom': {
                text: [ "å¥½ä¸»æ„ã€‚å›åˆ°æ•™å®¤æ„Ÿè§‰å®‰å…¨å¤šäº†ã€‚æˆ‘ä¼‘æ¯äº†å‡ åˆ†é’Ÿï¼Œå‘¼å¸é¡ºç•…å¤šäº†ã€‚" ],
                 action: () => {
                    gameState.health = Math.min(100, gameState.health + 5);
                    updateStatus();
                },
                choices: [
                    { text: "å¾ˆå¥½ï¼Œç°åœ¨å»èµ°å»Šå¦ä¸€å¤´çœ‹çœ‹ã€‚", nextScene: 'exploreFirstFloor' },
                    { text: "æ—¢ç„¶å®‰å…¨ï¼Œå†ä»”ç»†æœæœæ•™å®¤ã€‚", nextScene: 'searchClassroomAgain' }
                ]
            },
            'searchClassroomAgain': {
                text: [
                    "æˆ‘åˆç¿»äº†ä¸€éï¼Œè¿˜æ˜¯ä¸€æ ·ã€‚é™¤äº†ç°å°˜å’Œç ´çƒ‚çš„ä¹¦ï¼Œæ²¡ä»€ä¹ˆäº†ã€‚",
                    "å“¦ï¼Œå¢™ä¸Šæœ‰äº›å­©å­ä»¬çš„ç”»ã€‚ç”»çš„éƒ½æ˜¯æ¯›æ¯›è™«...ä½†æœ‰äº›æ¯›æ¯›è™«çš„'è„¸'ï¼Œè¢«ç”»æˆäº†å“­æ³£å’Œå°–å«çš„æ ·å­ã€‚"
                ],
                choices: [
                    { text: "è¿™äº›å­©å­......æˆ‘ä»¬èµ°å§ã€‚", nextScene: 'exploreFirstFloor' },
                    { text: "æŠŠç”»ä¹Ÿå¸¦ä¸Šï¼Œä½œä¸ºè¯æ®ã€‚", nextScene: 'takeDrawings' }
                ]
            },
            'takeDrawings': {
                text: ["...æˆ‘ä¸çŸ¥é“è¿™æœ‰ä»€ä¹ˆç”¨ï¼Œä½†æˆ‘æ’•ä¸‹äº†ä¸€å¼ ã€‚æ”¶å¥½äº†ã€‚"],
                action: () => {
                    gameState.inventory.push('å­©å­ä»¬çš„ç”»');
                    updateStatus();
                },
                choices: [
                    { text: "å¾ˆå¥½ï¼Œæˆ‘ä»¬èµ°ã€‚", nextScene: 'exploreFirstFloor' },
                    { text: "ä½†æ„¿è¿™èƒ½æœ‰ç”¨ã€‚", nextScene: 'exploreFirstFloor' }
                ]
            },
            'playground_search': {
                text: [
                    "æˆ‘...æˆ‘å°½åŠ›...æˆ‘åœ¨æ“åœºä¸­å¤®çœ‹åˆ°ä¸€ä¸ªå¥‡æ€ªçš„é‡‘å±èˆ±é—¨ï¼ŒåŠå¼€ç€ã€‚",
                    "ä½†æ˜¯...æˆ‘çš„è§†é‡å¼€å§‹æ¨¡ç³Šäº†...æˆ‘...æˆ‘æ’‘ä¸ä½äº†..."
                ],
                action: () => {
                    gameState.health -= 40;
                    gameState.radiation += 30;
                    updateStatus();
                },
                choices: [
                    { text: "å›æ¥ï¼æ—å³°ï¼åˆ«ç®¡é‚£ä¸ªèˆ±é—¨ï¼", nextScene: 'death_radiation' },
                    { text: "ï¼ˆä½¿ç”¨æ­¢ç—›è¯ï¼‰å¿«ç”¨æ­¢ç—›è¯ï¼å®ƒèƒ½å¸®ä½ é¡¶ä½ï¼", nextScene: 'playground_painkiller', condition: () => gameState.inventory.includes('æ­¢ç—›è¯')}
                ]
            },
            'playground_painkiller': {
                text: [
                    "ç”¨äº†...è¯æ•ˆä¸Šæ¥äº†ï¼Œç–¼ç—›å‡è½»äº†...æˆ‘èƒ½å†é è¿‘ä¸€ç‚¹...",
                    "èˆ±é—¨ä¸Šåˆ»ç€ä¸€ä¸ªå¾½ç« ...ä¸€ä¸ªè¢«å¤ªé˜³åŒ…å›´çš„çƒ§ç“¶...æˆ‘è®°ä¸‹äº†...",
                    "ä¸è¡Œ...æˆ‘å¾—æ’¤äº†...è¾å°„å¤ªå¼ºäº†..."
                ],
                action: () => {
                    gameState.inventory = gameState.inventory.filter(item => item !== 'æ­¢ç—›è¯');
                    gameState.flags.sawHatchSymbol = true;
                    gameState.health -= 20;
                    gameState.radiation += 15;
                    updateStatus();
                },
                choices: [
                    { text: "åšå¾—å¥½ï¼å¿«æ’¤å›æ¥ï¼", nextScene: 'playground_retreat' },
                    { text: "å†åšæŒä¸€ä¸‹ï¼çœ‹çœ‹èˆ±é—¨èƒ½ä¸èƒ½æ‰“å¼€ï¼", nextScene: 'tryHatch' }
                ]
            },
            'tryHatch': {
                text: [
                    "æˆ‘è¯•è¯•...å‘ƒ...èˆ±é—¨çº¹ä¸ä¸åŠ¨ï¼Œå¥½åƒè¢«å¡ä½äº†ã€‚",
                    "ä¸è¡Œï¼Œæˆ‘ä¸èƒ½å†å¾…ä¸‹å»äº†ï¼è¾å°„è®¡çš„è¯»æ•°è¦çˆ†è¡¨äº†ï¼æˆ‘å¾—æ’¤äº†ï¼"
                ],
                action: () => {
                    gameState.health -= 15;
                    gameState.radiation += 15;
                    updateStatus();
                },
                choices: [
                    { text: "æ˜ç™½ï¼Œç«‹åˆ»æ’¤é€€ï¼", nextScene: 'playground_retreat' },
                    { text: "åˆ«æ”¾å¼ƒï¼å†è¯•ä¸€æ¬¡ï¼", nextScene: 'death_radiation' }
                ]
            },
            'exploreFirstFloor': {
                text: [
                    "åœ¨èµ°å»Šçš„å¦ä¸€ç«¯ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªæ¥¼æ¢¯ã€‚æ—è¾¹è¿˜æœ‰ä¸¤æ‰‡é—¨ã€‚",
                    "ä¸€æ‰‡é—¨ä¸ŠæŒ‚ç€'åŒ»åŠ¡å®¤'çš„ç‰Œå­ï¼Œä½†è¢«ä¸€ä¸ªå¾ˆå¤æ‚çš„ç”µå­é”é”ä½äº†ã€‚",
                    "å¦ä¸€æ‰‡é—¨æ²¡æœ‰ä»»ä½•æ ‡è®°ï¼Œä½†é—¨ç¼é‡Œé€å‡ºä¸€ç§å¥‡æ€ªçš„è“è‰²å…‰èŠ’ã€‚æ„Ÿè§‰...å¾ˆè¯¡å¼‚ã€‚"
                ],
                choices: [
                    { text: "è¯•è¯•çœ‹èƒ½ä¸èƒ½æ‰“å¼€åŒ»åŠ¡å®¤çš„é”ã€‚", nextScene: 'tryMedicalOffice' },
                    { text: "è°ƒæŸ¥é‚£æ‰‡æ²¡æœ‰æ ‡è®°çš„ç¥ç§˜æˆ¿é—¨ã€‚", nextScene: 'mysteriousLab' }
                ]
            },
             'mysteriousLab': {
                text: [
                    "æˆ‘æ¨å¼€äº†è¿™æ‰‡é—¨...è¿™é‡Œ...æ˜¯ä¸€ä¸ªå®éªŒå®¤ã€‚",
                    "ä¸­å¤®æœ‰ä¸€ä¸ªå·¨å¤§çš„ç»ç’ƒå®¹å™¨ï¼Œé‡Œé¢å……æ»¡äº†æ¶²ä½“ï¼Œä¸€äº›ç®¡å­è¿æ¥ç€å®ƒã€‚å®¹å™¨é‡Œ...å¥½åƒæœ‰ä»€ä¹ˆä¸œè¥¿...ä½†æˆ‘çœ‹ä¸æ¸…ã€‚",
                    "å¢™è¾¹æœ‰ä¸€å°ç»ˆç«¯æœºè¿˜äº®ç€å±å¹•ã€‚"
                ],
                choices: [
                    { text: "å»çœ‹çœ‹ç»ˆç«¯æœºä¸Šå†™äº†ä»€ä¹ˆã€‚", nextScene: 'labTerminal' },
                    { text: "ç¦»é‚£ä¸ªå®¹å™¨è¿œç‚¹ï¼å…ˆæ£€æŸ¥æˆ¿é—´é‡Œæœ‰æ²¡æœ‰å±é™©ã€‚", nextScene: 'lab_safeCheck' }
                ]
            },
            'lab_safeCheck': {
                text: ["æˆ¿é—´é‡Œå¾ˆå®‰é™ï¼Œé™¤äº†è®¾å¤‡çš„å—¡å—¡å£°ã€‚è¾å°„æ°´å¹³æ¯”èµ°å»Šç¨é«˜ï¼Œä½†æ¯”æ“åœºå¥½å¤šäº†ã€‚çœ‹èµ·æ¥æš‚æ—¶å®‰å…¨ã€‚"],
                choices: [
                    { text: "å¥½å§ï¼Œå»çœ‹çœ‹ç»ˆç«¯æœºã€‚", nextScene: 'labTerminal' },
                    { text: "å†ä»”ç»†çœ‹çœ‹é‚£ä¸ªå·¨å¤§çš„å®¹å™¨ï¼Œé‡Œé¢åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ", nextScene: 'inspectContainer'}
                ]
            },
            'inspectContainer': {
                text: [
                    "æˆ‘å‡‘è¿‘äº†äº›...å¤©...å®¹å™¨é‡Œæ˜¯ä¸€ä¸ªäººå½¢çš„è½®å»“ï¼Œä½†å®ƒçš„å››è‚¢éå¸¸ä¸åè°ƒï¼Œå¥½åƒè¿˜åœ¨å¾®å¾®æŠ½åŠ¨ã€‚",
                    "çœ‹åˆ°è¿™ä¸ªä¸œè¥¿è®©æˆ‘æ±—æ¯›å€’ç«–ã€‚æˆ‘è¿˜æ˜¯ç¦»å®ƒè¿œç‚¹å¥½ã€‚"
                ],
                choices: [
                    { text: "å¤ªå¯æ€•äº†ã€‚å¿«å»çœ‹ç»ˆç«¯æœºï¼ŒæŸ¥æ¸…æ¥šè¿™åˆ°åº•æ˜¯ä»€ä¹ˆï¼", nextScene: 'labTerminal'},
                    { text: "åˆ«ç®¡å®ƒäº†ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ‰¾å‡ºå£å§ã€‚", nextScene: 'lab_findCode' }
                ]
            },
            'labTerminal': {
                text: [
                    "ç»ˆç«¯æœºä¸Šæ˜¾ç¤ºç€ä¸€ä»½æ—¥å¿—ã€‚",
                    "'...å®éªŒä½“S-01å¯¹'é˜³å…‰'è¾å°„è¡¨ç°å‡ºè¶…å¼ºé€‚åº”æ€§ã€‚ç»†èƒå†ç”Ÿé€Ÿåº¦æƒŠäºº...ä½†ä¼´éšç€ä¸å¯æ§çš„æ”»å‡»æ€§...'",
                    "'...æˆ‘ä»¬å¤±è´¥äº†ã€‚æ±¡æŸ“å·²ç»å¤±æ§ã€‚å°é”åè®®å¯åŠ¨ã€‚æ„¿ä¸Šå¸æ€œæ‚¯æˆ‘ä»¬...'"
                ],
                choices: [
                    { text: "è¿™å°è¯äº†æ—¥è®°é‡Œçš„å†…å®¹ã€‚è¿™é‡Œå°±æ˜¯æºå¤´ã€‚", nextScene: 'uncoverConspiracy', condition: () => gameState.flags.foundDiary },
                    { text: "åˆ«ç®¡é‚£ä¹ˆå¤šäº†ï¼Œå¿«æ‰¾æ‰¾æœ‰æ²¡æœ‰å¼€é”æˆ–è€…é€ƒå‡ºå»çš„åŠæ³•ï¼", nextScene: 'lab_findCode'}
                ]
            },
            'uncoverConspiracy': {
                getText: (state) => [
                    "æ²¡é”™..." + (state.flags.foundDiary ? "æ—¥è®°é‡Œçš„'å¤§é¸¡æ’'ï¼Œå¯èƒ½å°±æ˜¯è¿™ä¸ª'å®éªŒä½“S-01'ã€‚è€Œ'èªæ˜è±†'ï¼Œå°±æ˜¯ä»–ä»¬çš„å®éªŒè¯ç‰©ã€‚" : "ç»ˆç«¯æœºé‡Œçš„è®°å½•æåˆ°äº†'å®éªŒä½“S-01'å’Œå®éªŒè¯ç‰©..."),
                    "æˆ‘åœ¨ç»ˆç«¯æœºé‡Œç»§ç»­æœç´¢...",
                    "æ‰¾åˆ°äº†ä¾›åº”å•†è®°å½•...å°±æ˜¯'æ˜Œæ™¯é»„'ï¼ä»–æä¾›çš„'æ™¯å¾·é•‡ç‰¹äº§'æ˜¯å®éªŒä½“çš„ä¸»è¦é£Ÿç‰©æ¥æºï¼" + (state.flags.knowsChangJingHuang ? " å’Œæˆ‘åœ¨å•†åº—è´¦æœ¬ä¸Šçœ‹åˆ°çš„ä¸€æ ·ï¼" : ""),
                    "è¿˜æœ‰...æˆ‘æ‰¾åˆ°äº†é¡¹ç›®è´Ÿè´£äºº...ä¸€ä¸ªå«'æ°´ç‹'çš„äººã€‚æ‰€æœ‰çš„æŠ¥å‘Šéƒ½æŒ‡å‘ä»–ã€‚ä»–å¯¹æƒåŠ›çš„ç—´è¿·ï¼ŒåŠ ä¸Šæ˜Œæ™¯é»„å¯¹é‡‘é’±çš„è´ªå©ª...ä»–ä»¬æŠŠè¿™é‡Œå˜æˆäº†åœ°ç‹±ã€‚",
                    "è¿™åœºè¾å°„ï¼Œå°±æ˜¯ä¸ºäº†æ©ç›–è¿™é‡Œå‘ç”Ÿçš„ä¸€åˆ‡...ä¸€æ¬¡æ•…æ„çš„'å¤§æ‰«é™¤'ã€‚",
                    "è¿™ä¸ªåœ°æ–¹...å¿…é¡»è¢«æ‘§æ¯ã€‚"
                ],
                choices: [
                    { text: "ç»ˆç«¯æœºé‡Œæœ‰æ²¡æœ‰æåˆ°å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿ", nextScene: 'findFailsafe' },
                    { text: "è¿™äº›ä¿¡æ¯å¤ªé‡è¦äº†ã€‚æœ‰æ²¡æœ‰åŠæ³•æŠŠæ•°æ®ä¸‹è½½ä¸‹æ¥ï¼Ÿ", nextScene: 'downloadData' }
                ]
            },
            'downloadData':{
                text:[
                    "æˆ‘æ‰¾æ‰¾...æœ‰ä¸ªæ•°æ®æ¥å£ï¼Œä½†æˆ‘æ²¡æœ‰ä»»ä½•å­˜å‚¨è®¾å¤‡...",
                    "ç­‰ç­‰ï¼Œæˆ‘çš„ä¸ªäººé€šè®¯ç»ˆç«¯æœ‰å­˜å‚¨åŠŸèƒ½ï¼æ­£åœ¨å°è¯•ä¸‹è½½...",
                    "å¥½äº†ï¼å…³é”®æ—¥å¿—å’ŒæŠ¥å‘Šéƒ½ä¸‹è½½ä¸‹æ¥äº†ï¼å¦‚æœæˆ‘èƒ½å‡ºå»ï¼Œè¿™å°±æ˜¯ä»–ä»¬çš„ç½ªè¯ï¼"
                ],
                action: () => {
                    gameState.inventory.push('ç½ªè¯æ•°æ®');
                    updateStatus();
                },
                choices: [
                    { text: "å¹²å¾—æ¼‚äº®ï¼ç°åœ¨ï¼Œæ‰¾æ‰¾æ‘§æ¯è¿™é‡Œçš„åŠæ³•ã€‚", nextScene: 'findFailsafe'},
                    { text: "å¾ˆå¥½ï¼å¸¦ç€è¯æ®ï¼Œæˆ‘ä»¬æƒ³åŠæ³•è”ç³»ä½ çš„é˜Ÿä¼ã€‚", nextScene: 'lab_findCode' }
                ]
            },
            'findFailsafe': {
                text: [
                    "æ˜¯çš„...æœ‰ä¸€ä»½'æœ€ç»ˆå‡€åŒ–åè®®'çš„æ–‡ä»¶ã€‚è¿™çœ‹èµ·æ¥...åƒæ˜¯ä¸€ä¸ªé«˜å½“é‡çƒ­å‹ç‚¸å¼¹çš„è‡ªæ¯è£…ç½®è“å›¾ã€‚",
                    "æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæŠŠæ•´ä¸ªåœ°æ–¹ä»åœ°çƒä¸ŠæŠ¹æ‰ã€‚ä½†å¯åŠ¨å®ƒï¼Œæˆ‘è‡ªå·±ä¹Ÿå¯èƒ½è·‘ä¸æ‰ã€‚"
                ],
                choices: [
                    { text: "æˆ‘ä»¬ä¸èƒ½è®©ä½ å†’è¿™ä¸ªé™©ï¼å…ˆå»åŒ»åŠ¡å®¤æ‰¾æ‰¾åŠæ³•ï¼", nextScene: 'tryMedicalOfficeFromLab' },
                    { text: "è¿™æ˜¯å”¯ä¸€çš„åŠæ³•ã€‚ä¸ºäº†é˜»æ­¢ä»–ä»¬ï¼Œä¸ºäº†é‚£äº›å­©å­ã€‚å¯åŠ¨å®ƒã€‚", nextScene: 'goToBombLocation' }
                ]
            },
            'tryMedicalOfficeFromLab': {
                text: [ "ä½ è¯´å¾—å¯¹ï¼Œæˆ–è®¸åŒ»åŠ¡å®¤é‡Œæœ‰åˆ«çš„åŠæ³•ã€‚ç»ˆç«¯æœºä¸Šæœ‰æ²¡æœ‰å¼€é”çš„é€‰é¡¹ï¼Ÿ" ],
                 choices: [
                    { text: "æ‰¾æ‰¾çœ‹ã€‚", nextScene: 'lab_findCode' },
                    { text: "ç®—äº†ï¼Œé£é™©å¤ªå¤§ã€‚æˆ‘ä»¬è¿˜æ˜¯æ‰§è¡Œæœ€ç»ˆå‡€åŒ–åè®®å§ã€‚", nextScene: 'goToBombLocation'}
                ]
            },
             'lab_findCode': {
                text: [
                    "æ‰¾åˆ°äº†ï¼æ—¥å¿—æœ€åæåˆ°äº†ä¸€ä¸ªå¤‡ç”¨é€šè®¯åè®®ï¼Œæ¿€æ´»ç æ˜¯... 'HOPE'ã€‚",
                    "æ—è¾¹è¿˜æœ‰ä¸€ä¸ªé€‰é¡¹ï¼š'æ¿€æ´»åŒ»åŠ¡å®¤ç´§æ€¥å¼€é”'ã€‚",
                ],
                choices: [
                    { text: "æ¿€æ´»åŒ»åŠ¡å®¤å¼€é”ï¼", nextScene: 'unlockMedicalOffice' },
                    { text: "å…ˆè¯•è¯•é‚£ä¸ªå¤‡ç”¨é€šè®¯åè®®ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½è”ç³»ä¸Šå¤–ç•Œï¼", nextScene: 'tryBackupComms'}
                ]
            },
            'tryBackupComms':{
                text:[
                    "æ­£åœ¨å°è¯•æ¿€æ´»...åè®®å¯åŠ¨äº†ï¼Œä½†æ˜¯...å…¨æ˜¯å™ªéŸ³ã€‚",
                    "æ»‹...æ»‹...â€˜ä»–ä»¬éƒ½æ­»äº†â€™...æ»‹...â€˜è·‘â€™...ç„¶åå°±æ–­äº†ã€‚",
                    "è¿™å¥½åƒæ˜¯ä»¥å‰çš„æ±‚æ•‘ä¿¡å·...å¬å¾—æˆ‘å¿ƒé‡Œå‘æ¯›ã€‚"
                ],
                choices: [
                    { text: "åˆ«ç®¡äº†ï¼Œåªæ˜¯è¿‡å»çš„äº¡é­‚ã€‚æ‰“å¼€åŒ»åŠ¡å®¤çš„é”ã€‚", nextScene: 'unlockMedicalOffice'},
                    { text: "è¿™å¾ˆé‡è¦ã€‚å†å¬å¬ï¼Œçœ‹æœ‰æ²¡æœ‰åˆ«çš„çº¿ç´¢ã€‚", nextScene: 'listenAgain'}
                ]
            },
            'listenAgain': {
                text: [
                    "æˆ‘é‡æ–°è°ƒæ•´äº†é¢‘ç‡...è¿˜æ˜¯ä¸€æ ·çš„å™ªéŸ³å’Œç‰‡æ®µ...",
                    "æ²¡ä»€ä¹ˆæ–°å‘ç°äº†ï¼Œåè°ƒå‘˜ã€‚åªæ˜¯åœ¨æµªè´¹æ—¶é—´ã€‚"
                ],
                choices: [
                    { text: "å¥½å§ã€‚æ‰“å¼€åŒ»åŠ¡å®¤çš„é”ã€‚", nextScene: 'unlockMedicalOffice'},
                    { text: "ä¹Ÿè®¸æœ‰åŠ å¯†ä¿¡æ¯ã€‚ç®—äº†ï¼Œè¿˜æ˜¯å…ˆå¼€é”å§ã€‚", nextScene: 'unlockMedicalOffice'}
                ]
            },
             'unlockMedicalOffice': {
                text: [ "æ­£åœ¨æ“ä½œ...å¥½äº†ï¼æˆ‘å¬åˆ°èµ°å»Šé‚£è¾¹çš„åŒ»åŠ¡å®¤ä¼ æ¥ä¸€å£°è½»å“ï¼Œé”å¥½åƒå¼€äº†ï¼" ],
                action: () => { gameState.flags.medicalOfficeUnlocked = true; },
                choices: [
                    { text: "å¤ªæ£’äº†ï¼å¿«å»åŒ»åŠ¡å®¤ï¼", nextScene: 'enterMedicalOffice' },
                    { text: "å¾ˆå¥½ã€‚ç¦»å¼€å®éªŒå®¤å‰ï¼Œå†æ£€æŸ¥ä¸€éæœ‰æ²¡æœ‰é—æ¼ä»€ä¹ˆã€‚", nextScene: 'finalCheckLab'}
                ]
            },
            'finalCheckLab': {
                text: ["æˆ‘å¿«é€Ÿæ‰«äº†ä¸€çœ¼ï¼Œé™¤äº†é‚£å°ç»ˆç«¯æœºå’Œå¯æ€•çš„å®¹å™¨ï¼Œæ²¡æœ‰åˆ«çš„ä¸œè¥¿äº†ã€‚æˆ‘ä»¬èµ°å§ã€‚"],
                choices: [
                    { text: "å¥½çš„ï¼Œå»åŒ»åŠ¡å®¤ã€‚", nextScene: 'enterMedicalOffice'},
                    { text: "ä½ ç¡®å®šï¼Ÿå†çœ‹çœ‹é‚£ä¸ªå®¹å™¨ã€‚", nextScene: 'inspectContainerAgain' }
                ]
            },
            'inspectContainerAgain': {
                text: [
                    "æˆ‘åˆçœ‹äº†ä¸€çœ¼...æ²¡ä»€ä¹ˆå˜åŒ–ï¼Œè¿˜æ˜¯é‚£ä¸ªæ‰­æ›²çš„äººå½¢ã€‚åªæ˜¯çœ‹ç€å°±è®©æˆ‘ä¸èˆ’æœã€‚",
                    "æˆ‘ä»¬å¿«èµ°å§ã€‚"
                ],
                choices: [
                    { text: "å¥½å§ï¼Œç¦»å¼€è¿™é‡Œï¼Œå»åŒ»åŠ¡å®¤ã€‚", nextScene: 'enterMedicalOffice' },
                    { text: "ä¹Ÿè®¸å¯ä»¥ç ¸å¼€å®ƒï¼Ÿ", nextScene: 'smashContainer' }
                ]
            },
            'smashContainer': {
                text: [
                    "ä½ ç–¯äº†å—ï¼Ÿï¼æˆ‘æ‰ä¸...ç­‰ç­‰ï¼Œå®¹å™¨å¥½åƒè£‚äº†...",
                    "ï¼ˆç»ç’ƒç ´ç¢å£°ï¼Œæ¶²ä½“æµå‡ºçš„å£°éŸ³ï¼‰",
                    "ï¼ˆä¸€å£°ä¸ä¼¼äººç±»çš„å°–å•¸ï¼Œç„¶åæ˜¯é€šè®¯ä¸­æ–­çš„å¿™éŸ³ï¼‰"
                ],
                ending: { title: "ä½œèŒ§è‡ªç¼š", message: "ä½ é‡Šæ”¾äº†å®éªŒå®¤é‡Œæœ€ææ€–çš„å­˜åœ¨ã€‚å¥½å¥‡å¿ƒæ€æ­»äº†æ—å³°ï¼Œä¹Ÿå¯èƒ½å®³æ­»äº†æ›´å¤šäººã€‚" }
            },
            'tryMedicalOffice': {
                condition: () => gameState.flags.medicalOfficeUnlocked,
                choices: [
                    { text: "ï¼ˆåŒ»åŠ¡å®¤çš„é—¨å·²ç»å¼€äº†ï¼Œç›´æ¥è¿›å»ã€‚ï¼‰", nextScene: 'enterMedicalOffice' }
                ],
                fallbackScene: 'medicalOfficeLocked'
            },
            'medicalOfficeLocked': {
                text: [
                    "è¿™ä¸ªé”å¤ªå¤æ‚äº†ï¼Œæˆ‘å®Œå…¨æ‰“ä¸å¼€ã€‚ä¸Šé¢æœ‰ä¸ªå°é”®ç›˜ï¼Œå¥½åƒéœ€è¦å¯†ç æˆ–è€…å¡ç‰‡ã€‚",
                    "æˆ‘æ²¡åŠæ³•è¿›å»ã€‚"
                ],
                choices: [
                    { text: "æ²¡åŠæ³•äº†ã€‚æˆ‘ä»¬å†æƒ³æƒ³åˆ«çš„å‡ºè·¯ã€‚", nextScene: 'stuck' },
                    { text: "çœ‹çœ‹èƒ½ä¸èƒ½ç”¨è›®åŠ›æŠŠé”ç ¸å¼€ï¼Ÿ", nextScene: 'smashLock'}
                ]
            },
            'smashLock': {
                text: [
                    "æˆ‘æ‰¾äº†æ ¹é“ç®¡...å‘ƒå•Šï¼",
                    "ï¼ˆä¸€å£°å·¨å“ï¼Œç„¶åæ˜¯æ—å³°çš„ç—›å“¼ï¼‰",
                    "ä¸è¡Œ...é”æ²¡äº‹ï¼Œæˆ‘çš„æ‰‹è…•å¥½åƒæ‰­äº†...çœŸç–¼ã€‚"
                ],
                action: () => {
                    gameState.health -= 10;
                    updateStatus();
                },
                choices: [
                    { text: "åˆ«åšå‚»äº‹äº†ï¼æˆ‘ä»¬å†æƒ³åˆ«çš„åŠæ³•ã€‚", nextScene: 'stuck'},
                    { text: "ç”¨æ­¢ç—›è¯ï¼Œç„¶åæˆ‘ä»¬å†æƒ³åŠæ³•ã€‚", nextScene: 'stuck_painkiller', condition: () => gameState.inventory.includes('æ­¢ç—›è¯')}
                ]
            },
            'stuck_painkiller': {
                text: [ "å¥½å§...ç”¨äº†è¯ï¼Œæ‰‹è…•æ„Ÿè§‰å¥½å¤šäº†ã€‚ä½†æˆ‘è¿˜æ˜¯æ‰“ä¸å¼€é”ã€‚" ],
                action: () => {
                    gameState.inventory = gameState.inventory.filter(item => item !== 'æ­¢ç—›è¯');
                    updateStatus();
                },
                choices: [
                    { text: "å†æƒ³æƒ³ï¼Œä¸€å®šæœ‰åˆ«çš„è·¯ã€‚", nextScene: 'stuck' },
                    { text: "ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥å›å»å®éªŒå®¤æ‰¾çº¿ç´¢ï¼Ÿ", nextScene: 'mysteriousLab' }
                ]
            },
            'enterMedicalOffice': {
                 text: [
                    "æˆ‘è¿›æ¥äº†ã€‚è¿™é‡Œå¾ˆæ•´æ´ï¼Œä¸åƒåˆ«çš„åœ°æ–¹ã€‚",
                    "æ¶å­ä¸Šæœ‰å¾ˆå¤šè¯å“ã€‚æˆ‘æ‰¾åˆ°äº†...æŠ—è¾å°„æ³¨å°„å‰‚ï¼è¿˜æœ‰ä¸€å¥—å®Œæ•´çš„æ€¥æ•‘åŒ…ï¼",
                    "å¢™ä¸Šæœ‰ä¸€éƒ¨ç´§æ€¥é€šè®¯ç»ˆç«¯ï¼çœ‹èµ·æ¥è¿˜èƒ½ç”¨ï¼"
                ],
                action: () => {
                     if (!gameState.inventory.includes('æŠ—è¾å°„æ³¨å°„å‰‚')) gameState.inventory.push('æŠ—è¾å°„æ³¨å°„å‰‚');
                     gameState.health = 100;
                     updateStatus();
                },
                choices: [
                    { text: "ç”¨é€šè®¯ç»ˆç«¯è”ç³»ä½ çš„é˜Ÿä¼ï¼å¿«ï¼", nextScene: 'ending_contactTeam' },
                    { text: "å¤ªå¥½äº†ï¼ç°åœ¨æˆ‘ä»¬æœ‰èµ„æœ¬å»æ‰§è¡Œâ€˜æœ€ç»ˆå‡€åŒ–åè®®â€™äº†ã€‚", nextScene: 'goToBombLocationFromOffice', condition: () => gameState.flags.foundDiary}
                ]
            },
            'goToBombLocationFromOffice': {
                text: ["ä½ è¯´å¾—å¯¹ï¼Œåè°ƒå‘˜ã€‚æœ‰äº†è¿™äº›è¡¥ç»™ï¼Œæˆ‘æ›´æœ‰æŠŠæ¡äº†ã€‚ä¸ºäº†é‚£äº›å­©å­...æˆ‘ä»¬å»åšä¸ªäº†æ–­ã€‚"],
                choices: [
                    { text: "å‡ºå‘ï¼Œå»æ“åœºã€‚", nextScene: 'goToBombLocation' },
                    { text: "å†ç¡®è®¤ä¸€ä¸‹è®¡åˆ’ã€‚æˆ‘ä»¬è¦æ€ä¹ˆåšï¼Ÿ", nextScene: 'planRecap' }
                ]
            },
            'planRecap': {
                text: [
                    "è®¡åˆ’å°±æ˜¯ï¼šå»æ“åœºä¸‹çš„åœ°ä¸‹å®¤ï¼Œç”¨å¯†ç 'HOPE'å¯åŠ¨è£…ç½®ï¼Œç„¶ååœ¨æˆ‘èƒ½è·‘å¤šè¿œè·‘å¤šè¿œã€‚",
                    "ç®€å•ï¼Œç›´æ¥ï¼Œè€Œä¸”å¾ˆå¯èƒ½å›ä¸æ¥ã€‚ä½†æˆ‘å‡†å¤‡å¥½äº†ã€‚"
                ],
                choices: [
                    { text: "æˆ‘æ˜ç™½äº†ã€‚ç¥ä½ å¥½è¿ï¼Œæ—å³°ã€‚", nextScene: 'goToBombLocation' },
                    { text: "ç­‰ç­‰ï¼Œä¹Ÿè®¸è¿˜æœ‰åˆ«çš„åŠæ³•...", nextScene: 'reconsiderPlan' }
                ]
            },
            'reconsiderPlan': {
                text: [
                    "åˆ«çš„åŠæ³•ï¼Ÿåè°ƒå‘˜ï¼Œæˆ‘ä»¬å·²ç»æ²¡æœ‰æ—¶é—´äº†ã€‚è¿™æ˜¯å”¯ä¸€èƒ½ç¡®ä¿è¿™ä¸ªåœ°æ–¹è¢«å½»åº•å‡€åŒ–çš„æ–¹å¼ã€‚",
                    "æˆ‘æ„å·²å†³ã€‚"
                ],
                choices: [
                    { text: "...å¥½å§ã€‚æŒ‰è®¡åˆ’è¡Œäº‹ã€‚", nextScene: 'goToBombLocation' },
                    { text: "æˆ‘å°Šé‡ä½ çš„å†³å®šã€‚", nextScene: 'goToBombLocation' }
                ]
            },
            'stuck': {
                text: [
                    "æˆ‘è¢«å›°ä½äº†...æ‰€æœ‰çš„è·¯éƒ½è¯•è¿‡äº†ã€‚",
                    "è¾å°„è¶Šæ¥è¶Šå¼ºäº†ï¼Œæˆ‘æ„Ÿè§‰è¶Šæ¥è¶Šè™šå¼±...",
                    "å¯¹ä¸èµ·ï¼Œåè°ƒå‘˜...æˆ‘...æˆ‘å¯èƒ½æ’‘ä¸ä¸‹å»äº†..."
                ],
                choices: [
                     { text: "æŒ¯ä½œèµ·æ¥ï¼Œæ—å³°ï¼ä¸€å®šè¿˜æœ‰åŠæ³•ï¼", nextScene: 'death_despair' },
                     { text: "ç”¨æ‰æ­¢ç—›è¯ï¼Œè‡³å°‘èƒ½è®©ä½ èˆ’æœä¸€ç‚¹ã€‚", nextScene: 'death_despair_comfort', condition: () => gameState.inventory.includes('æ­¢ç—›è¯')}
                ]
            },
             'death_despair_comfort':{
                text: [
                    "å¥½å§...æˆ‘ç”¨äº†...",
                    "ç–¼ç—›æ˜¯å‡è½»äº†...ä½†ç»æœ›...è¿˜æ˜¯...åŒ…è£¹ç€æˆ‘...",
                    "ï¼ˆé€šè®¯å™¨ä¼ æ¥æœ€åä¸€å£°å¾®å¼±çš„å‘¼å¸ï¼Œç„¶åå½’äºæ²‰å¯‚ï¼‰"
                ],
                ending: { title: "å¹³é™çš„ç»æœ›", message: "åœ¨æ‰¾ä¸åˆ°å‡ºè·¯çš„æƒ…å†µä¸‹ï¼Œä½ è‡³å°‘è®©ä»–æ²¡æœ‰åœ¨ç—›è‹¦ä¸­æ­»å»ã€‚ä½†è¿™ä¾ç„¶æ˜¯ç»ˆç‚¹ã€‚" }
             },
            'goToBombLocation': {
                text: [
                    "æˆ‘æ˜ç™½äº†ã€‚",
                    "è“å›¾æ˜¾ç¤ºï¼Œè‡ªæ¯è£…ç½®çš„èµ·çˆ†ç‚¹å°±åœ¨æ“åœºä¸­å¤®é‚£ä¸ªé‡‘å±èˆ±é—¨ä¸‹é¢ã€‚æˆ‘å¾—å›åˆ°é‚£ä¸ªé«˜è¾å°„åŒºåŸŸ...",
                    "æˆ‘è¯¥æ€ä¹ˆåšï¼Ÿ"
                ],
                choices: [
                    { text: "ï¼ˆä½¿ç”¨æŠ—è¾å°„æ³¨å°„å‰‚ï¼‰ç°åœ¨å°±ç”¨æ‰å®ƒï¼Œèƒ½ä¿è¯ä½ çš„å®‰å…¨ã€‚", nextScene: 'useInjectorAndGo', condition: () => gameState.inventory.includes('æŠ—è¾å°„æ³¨å°„å‰‚') },
                    { text: "ç¡¬é—¯è¿‡å»ã€‚æˆ‘ä»¬æ²¡æ—¶é—´äº†ã€‚", nextScene: 'armTheBomb' }
                ]
            },
            'useInjectorAndGo': {
                text: [
                    "æ”¶åˆ°ã€‚æ­£åœ¨æ³¨å°„æŠ—è¾å°„è¯å‰‚...å˜¶...å¥½äº†ã€‚",
                    "è¾å°„æ¢æµ‹å™¨çš„è­¦æŠ¥å£°æ¶ˆå¤±äº†ã€‚æˆ‘ç°åœ¨æ„Ÿè§‰å¾ˆå¥½ï¼Œå……æ»¡äº†åŠ›é‡ã€‚æˆ‘å‡†å¤‡å¥½äº†ã€‚",
                    "æ­£åœ¨å‰å¾€æ“åœºåœ°ä¸‹å®¤ã€‚"
                ],
                action: () => {
                    gameState.inventory = gameState.inventory.filter(item => item !== 'æŠ—è¾å°„æ³¨å°„å‰‚');
                    gameState.radiation = Math.max(0, gameState.radiation - 50);
                    updateStatus();
                },
                choices: [
                    { text: "å°å¿ƒè¡Œäº‹ã€‚", nextScene: 'armTheBomb' },
                    { text: "æ—¶é—´ç´§è¿«ï¼Œå…¨é€Ÿå‰è¿›ï¼", nextScene: 'armTheBomb'}
                ]
            },
            'armTheBomb': {
                text: [
                    "æˆ‘åˆ°äº†...èˆ±é—¨ä¸‹é¢æ˜¯ä¸€ä¸ªåœ°ä¸‹å®¤ã€‚è¿™é‡Œçš„ç©ºæ°”å‡é‡å¾—å¯æ€•ï¼Œè¾å°„æ¢æµ‹å™¨åˆå¼€å§‹å°–å«äº†ã€‚",
                    "æ‰¾åˆ°äº†...è£…ç½®åœ¨è¿™é‡Œã€‚éœ€è¦è¾“å…¥æ¿€æ´»ç ...å°±æ˜¯ä¹‹å‰ç»ˆç«¯æœºä¸Šçœ‹åˆ°çš„...'HOPE'ã€‚",
                    "æˆ‘è¾“å…¥äº†...ï¼ˆå“”å“”å“”ï¼‰ç³»ç»Ÿå¯åŠ¨äº†ã€‚å±å¹•ä¸Šæ˜¾ç¤º'å‡€åŒ–ç¨‹åºå¯åŠ¨'ã€‚",
                    "å€’è®¡æ—¶...åªæœ‰3åˆ†é’Ÿï¼æˆ‘å¿…é¡»é©¬ä¸Šç¦»å¼€è¿™é‡Œï¼è­¦æŠ¥å“äº†ï¼"
                ],
                action: () => {
                    gameState.health -= 15;
                    gameState.radiation += 40;
                    updateStatus();
                },
                choices: [
                    { text: "å¿«è·‘ï¼æ—å³°ï¼åˆ«å›å¤´ï¼", nextScene: 'escapeSequence' },
                    { text: "æ‰¾ä¸ªåšå›ºçš„åœ°æ–¹èº²èµ·æ¥ï¼ä¹Ÿè®¸ä½ èƒ½æ’‘è¿‡çˆ†ç‚¸ï¼", nextScene: 'ending_sacrifice'}
                ]
            },
            'escapeSequence': {
                text: [
                    "ï¼ˆèƒŒæ™¯ä¼ æ¥åˆºè€³çš„è­¦æŠ¥å’Œå»ºç­‘ç»“æ„ä¸ç¨³çš„æ–­è£‚å£°ï¼‰",
                    "æˆ‘æ­£åœ¨å¾€å¤–è·‘ï¼æ¥¼æ¢¯...èµ°å»Š...ç°å°˜å’Œç¢çŸ³ä¸æ–­æ‰ä¸‹æ¥ï¼",
                    "å›åˆ°å¤§å…äº†ï¼å‡ºå£å°±åœ¨çœ¼å‰ï¼æˆ‘å†²å‡ºå»äº†ï¼"
                ],
                choices: [
                    { text: "ç»§ç»­è·‘ï¼ä¸è¦åœï¼", nextScene: 'ending_destroySunshine' },
                    { text: "å¤ªå¥½äº†ï¼ç°åœ¨è”ç³»ä½ çš„é˜Ÿä¼ï¼", nextScene: 'ending_destroySunshine'}
                ]
            },

            // ç»“å±€
            'death_radiation': {
                text: ["...ä¿¡å·...ä¸¢å¤±...", "ï¼ˆé€šè®¯å½»åº•ä¸­æ–­ï¼‰"],
                ending: { title: "è¾å°„è¿‡è½½", message: "æš´éœ²åœ¨æ“åœºé«˜å¼ºåº¦çš„è¾å°„ä¸‹ï¼Œä»–çš„èº«ä½“å´©æºƒäº†ã€‚å†’é™©ç²¾ç¥æœ‰æ—¶éœ€è¦ä»˜å‡ºä»£ä»·ã€‚" }
            },
            'death_despair': {
                text: ["ï¼ˆé€šè®¯å™¨ä¼ æ¥æœ€åä¸€å£°å¾®å¼±çš„å‘¼å¸ï¼Œç„¶åå½’äºæ²‰å¯‚ï¼‰"],
                ending: { title: "ç»æœ›è€Œç»ˆ", message: "åœ¨æ‰¾ä¸åˆ°å‡ºè·¯å’Œå¸Œæœ›çš„æƒ…å†µä¸‹ï¼Œä»–çš„æ„å¿—å´©æºƒäº†ï¼Œæœ€ç»ˆåœ¨å­¤ç‹¬ä¸­æ­»å»ã€‚" }
            },
            'ending_contactTeam': {
                text: [
                    "æ­£åœ¨å°è¯•è¿æ¥...",
                    "......",
                    "é€šäº†ï¼æ˜¯é˜Ÿé•¿ï¼ä»–ä»¬å°±åœ¨å­¦æ ¡å¤–é¢ï¼ä»–ä»¬æ­£åœ¨å¯åŠ¨æ•‘æ´ä¿¡æ ‡ï¼Œè®©æˆ‘è¿‡å»ï¼",
                    "æˆ‘å¾—æ•‘äº†ï¼åè°ƒå‘˜ï¼Œè°¢è°¢ä½ ï¼çœŸçš„...è°¢è°¢ä½ ï¼æ²¡æœ‰ä½ æˆ‘ç»å¯¹æ’‘ä¸åˆ°ç°åœ¨ï¼"
                ],
                ending: { title: "æˆåŠŸè·æ•‘", message: "é€šè¿‡è°¨æ…çš„åˆ¤æ–­å’Œæ­£ç¡®çš„æŒ‡å¼•ï¼Œä½ æˆåŠŸå¸®åŠ©æ—å³°æ‰¾åˆ°äº†ç”Ÿè·¯ï¼Œå¹¶ä¸ä»–çš„é˜Ÿä¼æ±‡åˆã€‚ä»»åŠ¡å®Œæˆã€‚" }
            },
            'ending_destroySunshine': {
                text: [
                    "æˆ‘è·‘å‡ºäº†è¶³å¤Ÿè¿œçš„è·ç¦»...èº«åä¼ æ¥ä¸€å£°éœ‡è€³æ¬²è‹çš„å·¨å“...å¤§åœ°éƒ½åœ¨éœ‡åŠ¨...",
                    "æˆ‘å›å¤´çœ‹ï¼Œä¸€æœµå°å‹çš„è˜‘è‡äº‘å‡èµ·ï¼Œåæ²¡äº†é‚£æ‰€ç½ªæ¶çš„å­¦æ ¡ã€‚",
                    "ä¸€åˆ‡éƒ½ç»“æŸäº†ã€‚é‚£äº›ç½ªæ¶çš„ç§˜å¯†ï¼Œå’Œ'æ°´ç‹'ã€'æ˜Œæ™¯é»„'çš„é‡å¿ƒä¸€èµ·ï¼Œè¢«åŸ‹è‘¬åœ¨äº†ç«ç„°é‡Œã€‚",
                    "æˆ‘...æˆ‘åšåˆ°äº†ã€‚åè°ƒå‘˜ï¼Œæˆ‘ä¸ºé‚£äº›å­©å­ä»¬æŠ¥ä»‡äº†ã€‚ç°åœ¨...æˆ‘è¦æƒ³åŠæ³•æ´»ä¸‹å»ã€‚",
                    "ï¼ˆé€šè®¯å™¨ä¿¡å·å¼€å§‹å‡å¼±ï¼‰...è°¢è°¢ä½ ...ä¸€ç›´...é™ªç€æˆ‘..."
                ],
                ending: { title: "ç‚¸æ¯é˜³å…‰", message: "ä½ æ­éœ²äº†ææ€–çš„çœŸç›¸ï¼Œå¹¶äº²æ‰‹å°†ç½ªæ¶çš„æ ¹æºä»å¤§åœ°ä¸ŠæŠ¹å»ã€‚è™½ç„¶æœªæ¥ä¾ç„¶æœªçŸ¥ï¼Œä½†ä½ ä¸ºé‚£äº›æ— è¾œçš„çµé­‚å¸¦æ¥äº†æœ€ç»ˆçš„å®¡åˆ¤ã€‚" }
            },
             'ending_sacrifice': {
                text: [
                    "èº²èµ·æ¥ï¼Ÿæ¥ä¸åŠäº†...æˆ‘å¬åˆ°çˆ†ç‚¸è£…ç½®çš„å—¡é¸£å£°è¶Šæ¥è¶Šå“...",
                    "ä¸è¿‡...è¿™æ ·ä¹Ÿå¥½ã€‚èƒ½å’Œè¿™äº›ç½ªæ¶ä¸€èµ·æ¶ˆå¤±ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§è§£è„±ã€‚",
                    "åè°ƒå‘˜ï¼Œå¦‚æœ...ä½ èƒ½æ”¶åˆ°è¿™æ®µæœ€åçš„ä¿¡æ¯ï¼Œå‘Šè¯‰ä»–ä»¬...è¿™é‡Œå‘ç”Ÿçš„ä¸€åˆ‡...",
                    "ï¼ˆä¸€å£°å·¨å“ï¼Œç„¶åæ˜¯æ°¸æ’çš„å¯‚é™ï¼‰"
                ],
                ending: { title: "è‹±é›„çš„ç‰ºç‰²", message: "ä»–æ²¡èƒ½é€ƒå‡ºçˆ†ç‚¸ï¼Œä½†ä»–çš„è¡ŒåŠ¨æ‘§æ¯äº†é‚ªæ¶çš„æ¸©åºŠã€‚ä»–ç”¨è‡ªå·±çš„ç”Ÿå‘½ï¼Œå®Œæˆäº†æœ€åçš„å‡€åŒ–ã€‚" }
            }

        };


        function showMessage(text, sender, specialClass = '') {
            const messageBubble = document.createElement('div');
            let classList = `message-bubble ${sender === 'character' ? 'character-message' : 'player-message'}`;
            if (specialClass) {
                classList += ` ${specialClass}`;
            }
            messageBubble.className = classList;
            messageBubble.textContent = text;
            chatContainer.appendChild(messageBubble);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // æ’­æ”¾æ¶ˆæ¯éŸ³æ•ˆ
            if (sender === 'character') {
                // æ ¹æ®æ¶ˆæ¯å†…å®¹æ’­æ”¾ä¸åŒéŸ³æ•ˆ
                if (specialClass === 'diary-entry') {
                    playSound('horror', "C2", "2n", 0.3);
                } else if (text.includes('è¾å°„') || text.includes('è­¦æŠ¥') || text.includes('å±é™©') || text.includes('çˆ†ç‚¸')) {
                    playSound('warning', "A3", "8n", 0.4);
                } else if (text.includes('æ‰¾åˆ°') || text.includes('å‘ç°') || text.includes('æˆåŠŸ') || text.includes('è·å¾—')) {
                    playSound('discover', "C5", "4n", 0.4);
                } else {
                    playSound('message', "G4", "8n", 0.5);
                }
            }
        }

        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.innerHTML = `<span></span><span></span><span></span>`;
            indicator.id = 'typing';
            chatContainer.appendChild(indicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // æ’­æ”¾è½»å¾®çš„æ‰“å­—éŸ³æ•ˆ
            playSound('select', "C6", "32n", 0.1);
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing');
            if (indicator) {
                indicator.remove();
            }
        }

        function playScene(sceneId) {
            choicesContainer.innerHTML = '';

            let scene = story[sceneId];
            gameState.currentScene = sceneId;

            if (!scene) {
                console.error(`Scene with id "${sceneId}" not found!`);
                return;
            }

            // This is a simple fix for a potential loop. A better system would be needed for complex games.
            if(gameState.flags.visited_scenes && gameState.flags.visited_scenes[sceneId] > 2) {
                scene = story['stuck'];
            } else {
                 if(!gameState.flags.visited_scenes) gameState.flags.visited_scenes = {};
                 gameState.flags.visited_scenes[sceneId] = (gameState.flags.visited_scenes[sceneId] || 0) + 1;
            }


            if (scene.condition && !scene.condition()) {
                scene = story[scene.fallbackScene];
            }


            if (scene.action) {
                const result = scene.action();
                if (result && result.text && result.nextScene) {
                    scene = { ...scene, ...result };
                }
            }
            updateStatus();

            // åœºæ™¯ç‰¹å®šéŸ³æ•ˆ
            playSceneAudio(sceneId);

            const messages = scene.getText ? scene.getText(gameState) : scene.text;
            const specialClass = scene.specialClass || '';
            let messageIndex = 0;

            function showNextMessage() {
                if (messageIndex < messages.length) {
                    showTypingIndicator();
                    const delay = 1500 + Math.random() * 1500;
                    setTimeout(() => {
                        removeTypingIndicator();
                        showMessage(messages[messageIndex], 'character', specialClass);
                        messageIndex++;
                        setTimeout(showNextMessage, 500); 
                    }, delay);
                } else {
                    if (scene.choices) {
                        displayChoices(scene.choices);
                    } else if (scene.ending) {
                        setTimeout(() => showEnding(scene.ending), 1000);
                    }
                }
            }
            showNextMessage();
        }

        function displayChoices(choices) {
            choicesContainer.innerHTML = '';
            const validChoices = choices.filter(choice => choice.condition === undefined || choice.condition());

            if (validChoices.length === 0) {
                 playScene('stuck'); 
                 return;
            }

            validChoices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.textContent = choice.text;
                button.className = "w-full bg-gray-700 hover:bg-gray-600 text-gray-200 font-semibold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105";
                button.onclick = async () => {
                    // é¦–æ¬¡ç‚¹å‡»æ—¶åˆå§‹åŒ–éŸ³æ•ˆç³»ç»Ÿ
                    if (!soundState.isInitialized) {
                        await soundState.init();
                    }

                    // æ’­æ”¾æŒ‰é’®ç‚¹å‡»éŸ³æ•ˆ
                    playSound('select', "E5", "16n", 0.6);

                    choicesContainer.innerHTML = '';
                    showMessage(choice.text, 'player');
                    setTimeout(() => playScene(choice.nextScene), 500);
                };
                choicesContainer.appendChild(button);
            });
        }
        
        function updateStatus() {
            const prevHealth = gameState.health || 100;
            const prevRadiation = gameState.radiation || 5;

            gameState.health = Math.max(0, Math.min(100, gameState.health));
            gameState.radiation = Math.max(0, Math.min(100, gameState.radiation));

            healthBar.style.width = `${gameState.health}%`;
            if (gameState.health > 60) {
                healthBar.className = 'bg-green-500 h-2.5 rounded-full progress-bar';
            } else if (gameState.health > 30) {
                healthBar.className = 'bg-yellow-500 h-2.5 rounded-full progress-bar';
            } else {
                healthBar.className = 'bg-red-600 h-2.5 rounded-full progress-bar';
            }

            radiationBar.style.width = `${gameState.radiation}%`;
             if (gameState.radiation < 40) {
                radiationBar.className = 'bg-yellow-500 h-2.5 rounded-full progress-bar';
            } else if (gameState.radiation < 75) {
                radiationBar.className = 'bg-orange-500 h-2.5 rounded-full progress-bar';
            } else {
                radiationBar.className = 'bg-red-600 h-2.5 rounded-full progress-bar';
            }

            if (gameState.inventory.length > 0) {
                inventoryDisplay.textContent = gameState.inventory.join(', ');
            } else {
                inventoryDisplay.textContent = 'ç©º';
            }

            // éŸ³æ•ˆå¤„ç†
            // è¾å°„è­¦æŠ¥
            if (gameState.radiation > 70 && prevRadiation <= 70) {
                playSound('warning', "A3", "8n", 0.6);
            }

            // å¿ƒè·³éŸ³æ•ˆï¼ˆä½è¡€é‡æ—¶ï¼‰
            if (gameState.health <= 30 && prevHealth > 30) {
                startHeartbeatLoop();
            } else if (gameState.health > 30 && prevHealth <= 30) {
                stopHeartbeatLoop();
            }

            if(gameState.health <= 0 && !story[gameState.currentScene]?.ending) {
                 playScene('death_despair');
            }
             if(gameState.radiation >= 100 && !story[gameState.currentScene]?.ending) {
                 playScene('death_radiation');
            }
        }

        function showEnding(ending) {
            modalTitle.textContent = ending.title;
            modalMessage.textContent = ending.message;
            modalOverlay.classList.remove('hidden');
            modalOverlay.style.opacity = 1;

            // åœæ­¢å¿ƒè·³å¾ªç¯
            stopHeartbeatLoop();

            // æ ¹æ®ç»“å±€æ’­æ”¾ä¸åŒéŸ³æ•ˆ
            const isGoodEnding = ending.title.includes('æˆåŠŸ') || ending.title.includes('è·æ•‘') || ending.title.includes('ç‚¸æ¯é˜³å…‰');

            if (isGoodEnding) {
                playEndingSound(true);
            } else {
                playEndingSound(false);
            }
        }

        // åœºæ™¯éŸ³æ•ˆå¤„ç†å‡½æ•°
        function playSceneAudio(sceneId) {
            // ç‰¹å®šåœºæ™¯éŸ³æ•ˆ
            const sceneAudioMap = {
                'goToPlayground': () => playSound('warning', "A3", "4n", 0.8),
                'playground_search': () => playSound('warning', "A3", "2n", 1.0),
                'armTheBomb': () => playSound('warning', "A3", "1n", 0.9),
                'escapeSequence': () => {
                    // çˆ†ç‚¸éŸ³æ•ˆåºåˆ—
                    playSound('warning', "C2", "1n", 0.8);
                    setTimeout(() => playSound('horror', "C1", "1n", 0.6), 1000);
                },
                'mysteriousLab': () => playSound('horror', "C2", "2n", 0.4),
                'inspectContainer': () => playSound('horror', "C2", "4n", 0.6),
                'smashContainer': () => playSound('horror', "C1", "1n", 0.8),
                'enterMedicalOffice': () => playSound('discover', "C5", "4n", 0.5),
                'unlockMedicalOffice': () => playSound('discover', "G5", "8n", 0.6),
                'takeLedger': () => playSound('discover', "E5", "8n", 0.4),
                'takeDiary': () => playSound('horror', "C3", "4n", 0.3),
                'readDiary': () => playSound('horror', "C2", "2n", 0.4),
                'enterCafeteria': () => playSound('horror', "D2", "4n", 0.3),
                'enterStore': () => playSound('discover', "F4", "8n", 0.3)
            };

            if (sceneAudioMap[sceneId]) {
                setTimeout(() => sceneAudioMap[sceneId](), 500);
            }
        }

        // æ¸¸æˆå¼€å§‹
        restartGame();

    </script>
</body>
</html>
